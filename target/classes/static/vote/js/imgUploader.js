!function(a){function e(a){return"image/"+a.replace(".","")}function f(a){var b,c,d;for(a=a||32,b="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",c=b.length,d="",i=0;a>i;i++)d+=b.charAt(Math.floor(Math.random()*c));return d}function g(a){return pos=a.lastIndexOf("."),suffix="",-1!=pos&&(suffix=a.substring(pos)),suffix}var d,b="https:"==document.location.protocol?!0:!1,c="https://pubali.oss-cn-hangzhou.aliyuncs.com";b||(c=c.replace("https://","http://")),a.uploadImg=function(b,h){function n(b,d){var h;h=window.location.href.indexOf("userinfo.aspx")>-1?"/handler/getoss.ashx?username="+encodeURIComponent(username):"/handler/getoss.ashx?activity="+activityID,a.get(h,function(a){var i,h=g(d);m=a.dir+Date.parse(new Date)/1e3+f(10)+h,l=a.host,i={key:m,policy:a.policy,OSSAccessKeyId:a.accessid,success_action_status:"200",signature:a.signature,"content-type":e(h)},b.setOption({url:c,multipart_params:i}),b.start()})}var i=4,j=b.trigger,k=b.maxSize||i,l="",m="",o=new plupload.Uploader({runtimes:"html5,silverlight,html4",browse_button:j,url:"https://oss.aliyuncs.com",silverlight_xap_url:"/js/plupload-2.2.1/Moxie.xap",filters:{mime_types:[{title:"图片文件",extensions:"jpg,gif,png,bmp,jpeg"}]},init:{FilesAdded:function(a,b){var c,e;if(0==b.length)return alert("请选择图片文件，"+k+"M以内"),!1;if(b.length>1){for(alert("提示：1次只能选择一个文件！"),c=0;c<b.length;c++)o.removeFile(b[c]);return!1}return size=b[0].size,size>1024*1024*parseInt(k)?(alert("请选择"+k+"M以内的图片文件！"),o.removeFile(b[0]),!1):(window.FileReader&&(e=new FileReader,e.readAsDataURL(b[0].getNative()),e.onload=function(a){var b=new Image;b.src=a.target.result,b.onload=function(){d=this.width,imgheight=this.height}}),n(a,b[0].name),void 0)},FileUploaded:function(b,c,e){var f,g,i,j,k,l;200==e.status?(f="//pubnew.paperol.cn/"+m,d||(g=document.createElement("img"),g.onload=function(){d=this.width,imgheight=this.height,showImage()},g.src=f),i=710,j=a("#divsetbag"),j&&j.length>0&&j.eq(0).hasClass("open")&&(k=j.find(".style-settings__type-pc"),k&&k.length>0&&k.eq(0).hasClass("on")&&(i=1920)),l=d&&d-i>0,f.indexOf(".gif")<0&&(!l&&size&&size-409600>0?f+="?x-oss-process=image/quality,q_85":l&&(f+="?x-oss-process=image/quality,q_90/resize,w_"+i)),h.call(null,f)):alert(e.response)}}});o.init()}}(jQuery);