<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.elvis.vote.dao.Admin.AdminDao">
    <sql id="selectPrefix">
        id,sno,pwd,email,sname,identify,sex,age,colleage,major,grade,classes,remark,del_flag
    </sql>

    <select id="selectAllUsers" parameterType="java.lang.String" resultType="com.elvis.vote.pojo.User">
        select
        <include refid="selectPrefix"></include>
        from user where identify = #{identify}
    </select>


    <select id="selectUserByValue" resultType="com.elvis.vote.pojo.User">
        select
        <include refid="selectPrefix"></include>
        from user where identify = #{identify}
        <if test="sno != null">
            and sno like concat(#{sno},'%')
        </if>
        <if test="sname != null">
            and sname like concat('%',#{sname},'%')
        </if>
        <if test="colleage != null">
            and colleage like concat('%',#{colleage},'%')
        </if>
        <if test="major != null">
            and major like concat('%',#{major},'%')
        </if>
        <if test="grade != null">
            and grade like concat('%',#{grade},'%')
        </if>
        <if test="classes != null">
            and classes like concat('%',#{classes},'%')
        </if>
    </select>

    <!--邮箱是否已经注册了-->
    <select id="isEmailExist" resultType="java.lang.Integer">
        select count(1) from user where email = #{email}
    </select>

    
    <!--更改邮箱-->
    <update id="updateEmail">
        update user set email = #{email} where id = #{id}
    </update>





    <!--    权限-->
    <select id="searchColleages" resultType="com.elvis.vote.pojo.Colleage">
        select colleage_id,colleage_name
        from colleage
    </select>

    <select id="searchMajors" resultType="com.elvis.vote.pojo.Major">
        select major_id,major_name
        from colleage
        LEFT JOIN major
        on colleage.colleage_id = major.colleage_id
        where colleage_name=#{colleageName}
    </select>

    <select id="searchGrades" resultType="com.elvis.vote.pojo.Grade">
        select grade_id,grade_name
        from colleage
        LEFT JOIN major
        on colleage.colleage_id = major.colleage_id
        LEFT JOIN grade
        on major.major_id = grade.major_id
        where colleage_name=#{colleageName} and major_name=#{colleageName}
    </select>

    <select id="searchClasses" resultType="com.elvis.vote.pojo.Classes">
        select classes_id,classes_name
        from colleage
        LEFT JOIN major
        on colleage.colleage_id = major.colleage_id
        LEFT JOIN grade
        on major.major_id = grade.major_id
        LEFT JOIN	classes
        on grade.grade_id = classes.grade_id
        where colleage_name=#{colleageName}
        and major_name=#{majorName}
         and grade_name=#{gradeName}
    </select>


</mapper>