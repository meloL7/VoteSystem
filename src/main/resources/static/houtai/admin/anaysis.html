<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8"/>
    <title>主页</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta content="Premium Multipurpose Admin & Dashboard Template" name="description"/>
    <meta content="MyraStudio" name="author"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

    <!-- App favicon -->
    <!-- <link rel="shortcut icon" href="assets/images/favicon.ico"> -->

    <!-- App css -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="assets/css/icons.min.css" rel="stylesheet" type="text/css"/>
    <link href="assets/css/theme.min.css" rel="stylesheet" type="text/css"/>
    <link href="../plugins/bootstrap-datepicker/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css"/>
    <!-- Dropify css -->
    <link href="../plugins/dropify/dropify.min.css" rel="stylesheet" type="text/css"/>

    <!-- jQuery  -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/metismenu.min.js"></script>
    <script src="assets/js/waves.js"></script>
    <script src="assets/js/simplebar.min.js"></script>

    <style>
        .box1 {
            width: 100%;
            height: 2720px;
            border: 4px double seagreen;
            margin: auto;
            float: left;
        }
    </style>
</head>

<body>

<!-- Begin page -->
<div id="layout-wrapper">
    <header id="page-topbar">
        <div class="navbar-header">
            <!-- LOGO -->
            <div class="navbar-brand-box d-flex align-items-left">
                <a href="index.html" class="logo">
							<span>
								<img src="assets/images/logo-light.png" alt="" height="18">
							</span>
                    <i>
                        <img src="assets/images/logo-small.png" alt="" height="24">
                    </i>
                </a>
                <button type="button"
                        class="btn btn-sm mr-2 d-lg-none px-3 font-size-16 header-item waves-effect waves-light"
                        id="vertical-menu-btn">
                    <i class="fa fa-fw fa-bars"></i>
                </button>
            </div>
            <div class="dropdown d-inline-block ml-2">
                <button type="button" class="btn header-item waves-effect waves-light" id="page-header-user-dropdown"
                        data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="false">
                    <span class="d-none d-sm-inline-block ml-1" id="admin_name">Admin</span>
                </button>
            </div>
        </div>
    </header>
</div>
<script>
    $(function () {
        var name = sessionStorage.getItem('username');
        console.log("name=" + name);
        var ii = $("#admin_name").html();
        // var ii = document.getElementById("adminname");
        console.log("---" + ii);

        if (name == null) {
            // $("#admin_name").html('请登录');
            // $("#adminname").attr("href","pages-login.html");
            // $("#page-header-user-dropdown").attr("onclick",returnLogin());
            window.location.href = "/elvis/houtai/admin/pages-login.html";
        } else {
            $("#admin_name").html(name);//用户栏
        }

    });

    function logout() {
        sessionStorage.clear();
    }
</script>


<!-- ========== Left Sidebar Start ========== -->
<div class="vertical-menu">

    <div data-simplebar class="h-100">

        <!--- Sidemenu -->
        <div id="sidebar-menu">
            <!-- Left Menu Start -->
            <ul class="metismenu list-unstyled" id="side-menu">
                <li class="menu-title">菜单</li>
                <li>
                    <a href="index.html" class="waves-effect">
                        <i class="mdi mdi-view-dashboard"></i>
                        <span>首页</span></a>
                </li>
                <li>
                    <a href="javascript: void(0);" class="has-arrow waves-effect">
                        <i class=" mdi mdi-account-multiple-outline"></i>
                        <span>用户管理</span></a>

                    <ul class="sub-menu" aria-expanded="false">
                        <li><a href="teacher.html">教师管理</a></li>
                        <li><a href="student.html">学生管理</a></li>
                    </ul>
                </li>
                <li>
                    <a href="javascript: void(0);" class="has-arrow waves-effect">
                        <i class=" mdi mdi-clipboard-text-play"></i>投票管理</span></a>
                    <ul class="sub-menu" aria-expanded="false">
                        <li><a href="naire_manage.html">问卷管理</a></li>
                        <li><a href="vote_manage.html">选择管理</a></li>
                    </ul>
                </li>

                <li>
                    <a href="javascript: void(0);" class="has-arrow waves-effect">
                        <i class="mdi mdi-book-open-page-variant"></i>
                        <span>投票详情管理</span></a>
                    <ul class="sub-menu" aria-expanded="false">
                        <li><a href="naire_detail.html">问卷详情</a></li>
                        <li><a href="vote_detail.html">选择详情</a></li>
                    </ul>
                </li>
                <li>
                    <a href="javascript: void(0);" class="has-arrow waves-effect">
                        <i class="mdi mdi-equalizer"></i>
                        <span>分析</span></a>
                    <ul class="sub-menu" aria-expanded="false">
                        <li><a href="anaysis.html">问卷分析</a></li>

                    </ul>
                </li>
                <li>
                    <a href="javascript: void(0);" class="has-arrow waves-effect">
                        <i class="mdi mdi-wrench"></i>
                        <span>系统</span></a>
                    <ul class="sub-menu" aria-expanded="false">
                        <li><a href="pages-login.html" onclick="logout()" id="quit">退出</a></li>

                    </ul>
                </li>
            </ul>
        </div>
        <!-- Sidebar -->
    </div>
</div>
<!-- Left Sidebar End -->

<!-- ============================================================== -->
<!-- Start right Content here -->
<!-- ============================================================== -->
<div class="main-content" >

    <div class="page-content">
        <div class="container-fluid" id="rowbody">

            <!-- start page title -->
            <div class="row">
                <div class="col-12">
                    <div class="page-title-box d-flex align-items-center justify-content-between">
                        <h4 class="mb-0 font-size-18">问卷分析</h4>
                    </div>
                </div>
            </div>
            <!-- end page title -->

<!--            <div class="row">-->
<!--                <div class="col-xl-3">-->
<!--                </div>-->
<!--                <div class="col-xl-6">-->
<!--                    <div class="card">-->
<!--                        <div class="card-body">-->
<!--                            <div class="chartjs-size-monitor">-->
<!--                                <div class="chartjs-size-monitor-expand">-->
<!--                                    <div class=""></div>-->
<!--                                </div>-->
<!--                                <div class="chartjs-size-monitor-shrink">-->
<!--                                    <div class=""></div>-->
<!--                                </div>-->
<!--                            </div>-->

<!--                            <h4 class="card-title">Line Chart</h4>-->
<!--                            <p class="card-subtitle mb-4">Example of line chart chart js.</p>-->

<!--                            <canvas id="lineChart" width="730" height="365" class="chartjs-render-monitor box"-->
<!--                                    style="display: block; height: 332px; width: 664px;">-->

<!--                            </canvas>-->

<!--                        </div> &lt;!&ndash; end card-body&ndash;&gt;-->
<!--                    </div> &lt;!&ndash; end card&ndash;&gt;-->
<!--                </div> &lt;!&ndash; end col &ndash;&gt;-->

<!--            </div>-->
<!--            &lt;!&ndash; end row&ndash;&gt;-->


        </div> <!-- container-fluid -->
    </div>
    <!-- End Page-content -->
    <!-- 需要保留上一次查询的数据 -->
    <div id="returnlast">
        <a href="#" onclick="returnPre(this)" type="button" class="btn btn-primary btn-lg waves-effect waves-light">返回上一级</a>
    </div>
</div>
<!-- End Page-content -->


</div>
<!-- end main content-->
</div>
<!-- END layout-wrapper -->

<!-- Overlay-->
<div class="menu-overlay"></div>





<!-- Morris Js-->
<script src="../plugins/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
<!--<script src="../plugins/bootstrap-datepicker/bootstrap-datepicker.zh-CN.js"></script>-->
<script src="../plugins/dropify/dropify.min.js"></script>
<!--<script src="../plugins/ckeditor/ckeditor.js"></script>-->
<!-- Morris Custom Js-->
<script src="assets/pages/dashboard-demo.js"></script>

<!-- App js -->
<script src="assets/js/theme.js"></script>
<script src="assets/pages/fileuploads-demo.js"></script>

<!-- Echart js -->

<script src="assets/js/echarts.min.js"></script>
<script src="js/vote.js"></script>
<script src="js/vote1.js"></script>
<script src="js/anaysis.js"></script>

<script>
    $(function () {
        //获取href里面的值
        var href = window.location.search.substr(1);
        // console.log((href!=null)+"6666");
        var split = href.split("&");

        var value = [];
        for (var i = 0; i < split.length; i++) {
            var v = split[i].split("=");
            value.push(v[1]);
        }

        var condition = decodeURI(value[0]);
        var content = decodeURI(value[1]);
        var type = value[2];
        var vote_status = value[3];
        var indexpage = value[4];
        var vote_id = value[5];
        getSelect(vote_id)
    })

    function  getSelect(voteId) {

        $.post(
            "/elvis/admin/querySelect",
            {
                voteId
            },
            function (data) {
               // console.log("2222"+data.data)
                addBox(data.data)
                addBox(data.data)

                for(var i in data.data) {
                    var mychart = echarts.init(document.getElementsByClassName('box')[i]);
                    getanse(data.data[i],mychart)
                    var mychart2 = echarts.init(document.getElementsByClassName('box')[1]);

                    getanse(data.data[i],mychart2)


                }
                })

    }




    function getanse(select,mychart) {
        var Data = new Array();
        var xue = new Array();
        var selectId = select.select_id;
        // console.log(selectId)
            //根据id获取选项的名字和数量
        $.post(
                "/elvis/admin/queryAnse",
                {
                    selectId
                },
                function (data) {
                    console.log(data.data[0])
                    for (let i in data.data) {
                        var t = data.data[i];
                         var xuanxiang = t.option.option_content;
                        var demo = {
                            name:xuanxiang,
                            value:t.value
                        }
                        xue.push(xuanxiang)
                        Data.push(demo)
                    }
                    console.log(xue)
                    console.log(Data)
                    var option = {
                        tooltip: {
                            trigger: 'item',
                            formatter: "{a} <br/>{b}: {c} ({d}%)"
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left',
                            data: xue
                        },
                        series: [{
                            name: select.select_title,
                            type: 'pie',
                            radius: '55%',
                            center: ['50%', '60%'],
                            data: Data,
                            itemStyle: {
                                emphasis: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }]
                    };
                    mychart.setOption(option)
                })



    }
    function  addBox(select) {
       var body =  $("#rowbody")
        // body.empty()
        for(var i of select){
            var box = ` <div class="row">
                <div class="col-xl-3">
                </div>
                <div class="col-xl-6">
                    <div class="card">
                        <div class="card-body">
                            <div class="chartjs-size-monitor">
                                <div class="chartjs-size-monitor-expand">
                                    <div class=""></div>
                                </div>
                                <div class="chartjs-size-monitor-shrink">
                                    <div class=""></div>
                                </div>
                            </div>

                            <h4 class="card-title">${i.select_tiltle}</h4>

                            <canvas id="lineChart" width="730" height="365" class="chartjs-render-monitor box"
                                    style="display: block; height: 332px; width: 664px;">

                            </canvas>

                        </div> <!-- end card-body-->
                    </div> <!-- end card-->
                </div> <!-- end col -->

            </div>`
            body.append(box)
        }

    }
</script>
</body>

</html>
